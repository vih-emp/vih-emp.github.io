<!DOCTYPE html>
<html lang="en"></html>
<head>
	<meta charset="UTF-8">
	<title>Pomodoro Timer</title>
	<style>
		body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
		#timer { font-size: 48px; margin-bottom: 20px; }
		#tomatoes { font-size: 24px; margin-bottom: 20px; }
		button { font-size: 18px; padding: 10px 20px; }
	</style>
</head>
<body>
	<div id="timer">25:00</div>
	<div id="tomatoes">üçÖ: 0</div>
	<button id="startPause">Start</button>
	<button id="reset">Reset</button>

	<script>
		let timeLeft = 25 * 60;
		let timer = null;
		let isFocus = true;
		let sessionCount = 0;
		let tomatoes = 0;

		const timerDisplay = document.getElementById('timer');
		const tomatoDisplay = document.getElementById('tomatoes');
		const button = document.getElementById('startPause');
		const resetButton = document.getElementById('reset');

		function updateTimerDisplay() {
			const min = Math.floor(timeLeft / 60).toString().padStart(2, '0');
			const sec = (timeLeft % 60).toString().padStart(2, '0');
			timerDisplay.textContent = `${min}:${sec}`;
		}

		function updateTomatoCounter() {
			tomatoDisplay.textContent = `üçÖ: ${tomatoes}`;
		}

		function saveTomatoes() {
			localStorage.setItem('pomodoroTomatoes', tomatoes);
		}

		function loadTomatoes() {
			const saved = localStorage.getItem('pomodoroTomatoes');
			if (saved) tomatoes = parseInt(saved, 10);
			updateTomatoCounter();
		}

		function playSoothingSound() {
			return new Promise((resolve) => {
				const ctx = new (window.AudioContext || window.webkitAudioContext)();
				const oscillator = ctx.createOscillator();
				const gain = ctx.createGain();

				oscillator.type = 'sine';
				oscillator.frequency.setValueAtTime(440, ctx.currentTime); // A4 note
				gain.gain.setValueAtTime(0.1, ctx.currentTime); // Soft volume

				oscillator.connect(gain);
				gain.connect(ctx.destination);

				oscillator.start();
				oscillator.stop(ctx.currentTime + 1.2); // 1.2 seconds

				oscillator.onended = () => {
					ctx.close();
					resolve();
				};
			});
		}

		function playSoothingAndStartNext() {
			playSoothingSound().then(() => {
				if (isFocus) {
					sessionCount++;
					tomatoes++;
					saveTomatoes();
					updateTomatoCounter();
					if (sessionCount % 4 === 0) {
						timeLeft = 15 * 60; // Long break
					} else {
						timeLeft = 5 * 60; // Short break
					}
					isFocus = false;
					button.textContent = 'Pause Break';
				} else {
					timeLeft = 25 * 60; // Focus
					isFocus = true;
					button.textContent = 'Pause';
				}
				updateTimerDisplay();
				startTimer(); // Auto-start next period
			});
		}

		function startTimer() {
			if (timer) return;
			timer = setInterval(() => {
				if (timeLeft > 0) {
					timeLeft--;
					updateTimerDisplay();
				} else {
					clearInterval(timer);
					timer = null;
					playSoothingAndStartNext();
				}
			}, 1000);
			button.textContent = isFocus ? 'Pause' : 'Pause Break';
		}

		function pauseTimer() {
			if (timer) {
				clearInterval(timer);
				timer = null;
				button.textContent = isFocus ? 'Start' : 'Start Break';
			}
		}

		function resetTimer() {
			pauseTimer();
			timeLeft = 25 * 60;
			isFocus = true;
			sessionCount = 0;
			updateTimerDisplay();
			button.textContent = 'Start';
		}

		button.addEventListener('click', () => {
			if (timer) {
				pauseTimer();
			} else {
				startTimer();
			}
		});

		resetButton.addEventListener('click', resetTimer);

		// Initialize
		loadTomatoes();
		updateTimerDisplay();
	</script>
</body>
</html>
